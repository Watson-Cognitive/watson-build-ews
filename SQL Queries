Queries
--------
set schema = 'EWS_DATABASE';

//Dashboard

SELECT distinct CM.CM_CP_ID,
    (CDC_CNTRY_RISK) AS CDC_CNTRY_RISK,
    CM.CM_CNCTD_CP_ID,
    CM.CM_CP_NAME,
    CM.CM_ULT_PARNT_NAME,
   CDC_LEGAL_ENTITYTYPE AS CDC_LEGAL_ENTITYTYPE,
    CDC_MTM_NET AS CDC_MTM_NET,
   CDC_CVA  AS CDC_CVA,
     AD_SCORE AS AD_SCORE,
AD_SCORE_UPDTIME AS AD_SCORE_UPDTIME,
    CM.CM_CURRENT_RATING  
 FROM COUNTERPARTY_MASTER CM,DETAILS_FROM_CLIENT,ANALYTICAL_DETAILS,TRACKING_TABLE
 WHERE CM.CM_CP_ID = TT_COUNTERPARTY_ID
 and TT_CLIENT_ID = 'CLID2'
 and CDC_CLIENT_ID=TT_CLIENT_ID
 AND CDC_CP_ID = CM.CM_CP_ID 
   AND TT_TRACKING_STATUS = 'Y'
   AND  CM.CM_CP_ID=AD_COUNTERPARTY_ID 
 ORDER BY CM.CM_CP_NAME;
 
 SELECT distinct CM.CM_CP_ID, (CDC_CNTRY_RISK) AS CDC_CNTRY_RISK, CM.CM_CNCTD_CP_ID, CM.CM_CP_NAME, CM.CM_ULT_PARNT_NAME,    CDC_LEGAL_ENTITYTYPE AS CDC_LEGAL_ENTITYTYPE, CDC_MTM_NET AS CDC_MTM_NET,    CDC_CVA  AS CDC_CVA,  AD_SCORE AS AD_SCORE, AD_SCORE_UPDTIME AS AD_SCORE_UPDTIME, CM.CM_CURRENT_RATING   FROM COUNTERPARTY_MASTER CM,DETAILS_FROM_CLIENT,ANALYTICAL_DETAILS,TRACKING_TABLE  WHERE CM.CM_CP_ID = TT_COUNTERPARTY_ID  and TT_CLIENT_ID = ?  and CDC_CLIENT_ID=TT_CLIENT_ID  AND CDC_CP_ID = CM.CM_CP_ID    AND TT_TRACKING_STATUS = 'Y'    AND  CM.CM_CP_ID=AD_COUNTERPARTY_ID  ORDER BY AD_SCORE DESC
 
//News Only
 SELECT distinct CM.CM_CNCTD_CP_ID,CM.CM_CP_NAME,CM.CM_ULT_PARNT_NAME,AD_SCORE,AD_SCORE_UPDTIME,CM.CM_CURRENT_RATING
 FROM COUNTERPARTY_MASTER CM,DETAILS_FROM_CLIENT,ANALYTICAL_DETAILS,TRACKING_TABLE
 WHERE CM.CM_CP_ID = TT_COUNTERPARTY_ID
 and TT_CLIENT_ID = 'CLID1'
 and CDC_CLIENT_ID=TT_CLIENT_ID
 AND CDC_CP_ID = CM.CM_CP_ID 
   AND TT_TRACKING_STATUS = 'Y'
   AND  CM.CM_CP_ID=AD_COUNTERPARTY_ID 
 ORDER BY CM.CM_CP_NAME;

//Connected Counterparty
SELECT distinct CM.CM_CNCTD_CP_ID,
	   CM.CM_CP_ID,
	   CM.CM_CP_NAME,
	   CM.CM_ULT_PARNT_NAME,
	   CM.CM_NTR_RLTN,
	   CDC.CDC_LEGAL_ENTITYTYPE,
	   CDC.CDC_MTM_NET,
	   CDC.CDC_CVA,
	   AD.AD_SCORE,
	   AD.AD_SCORE_UPDTIME,
	   CM.CM_CURRENT_RATING 
  FROM COUNTERPARTY_MASTER CM 
  JOIN DETAILS_FROM_CLIENT CDC ON(CM.CM_CP_ID = CDC.CDC_CP_ID)
  JOIN ANALYTICAL_DETAILS AD ON(AD.AD_COUNTERPARTY_ID = CM.CM_CP_ID )
 WHERE CM_NTR_RLTN != 'Self' AND CM.CM_CNCTD_CP_ID = 28 
	   

//Counterparty Details - Portfolio Details
SELECT DISTINCT CDC_LEGAL_ENTITYTYPE,
	   CDC_PRODUCTS,
	   CDC_DEAL_COUNT,
	   CDC_EXP_TYPE,
	   CDC_MEASURE,
	   CDC_TIME_BAND,
	   CDC_LIMIT,
	   CDC_EXPOSURE,
	   CDC_AVAILABLE,
	   CDC_LIMIT_EXP,
	   CDC_TENOR 
  FROM DETAILS_FROM_CLIENT 
 WHERE CDC_CP_ID  = 'CIDANP' 
 
  
//Portfolio Details Right Side
SELECT distinct CM.CM_CP_NAME,
	   CM.CM_CP_ID,
	   CM.CM_ULT_PARNT_NAME,
	   CM.CM_ULT_PARENT_ID,
	   CM.CM_CURRENT_RATING,
	   CLM.CLM_RISK_OFFICER,
	   CDC.CDC_INT_RATING,
	   CDC.CDC_CNTRY_RISK,
	   CDC.CDC_CNTRY_DMCILE
  FROM COUNTERPARTY_MASTER CM
  JOIN DETAILS_FROM_CLIENT CDC ON (CDC.CDC_CP_ID = CM.CM_CP_ID)
  JOIN CLIENT_MASTER CLM ON (CLM.CLM_CLIENT_ID = CDC.CDC_CLIENT_ID)
 WHERE CM.CM_CP_ID = 'CIDANP'


 
//Analytics Page	
/Main Sourcs
 SELECT NS_DOMAIN_NAME,
 		'News' as "Type",
		NS_GEOGRAPHY,
		NS_NUMBER_ARTICLES AS NR_SCORE,
		NS_SCORE,
		sysdate AS NR_CAPTURE_DTTIME
   FROM NEWS_SOURCE_MASTER
  WHERE NS_CP_ID = 'CIDGOPRO';
  
/News Header
SELECT NR_NEWS_HEADER,
	   NR_PBLSH_DTTIME
  FROM NEWS_REPOSITORY
 WHERE NR_COUNTERPARTY_ID = 'CIDLLCKR'
 
//News Link
SELECT NR_NEWS_HEADER,
	   NR_SCORE,
	   NR_PBLSH_DTTIME,
	   NR_CAPTURE_DTTIME,
	   'Risk Officer 1' AS CLM_RISK_OFFICER
  FROM NEWS_REPOSITORY NR
 WHERE NR_COUNTERPARTY_ID = 'CIDGOPRO'
   AND NR_NEWS_SOURCE = 'The Street'

/Tag Cloud
create table tag_cloud(cp_id varchar(20),text varchar(100),weight int,orientation char(1))

insert into tag_cloud values('CIDANP','Legal',13,'h')
insert into tag_cloud values('CIDANP','Credit',9,'h')
insert into tag_cloud values('CIDANP','bankruptcy',15,'v')

select text,weight,orientation from tag_cloud;

//BARCHART
CREATE TABLE BAR_CHART(CP_ID VARCHAR(50),date VARCHAR(20),sentimentScore INTEGER,creditScore INTEGER)

INSERT INTO BAR_CHART VALUES('CIDFNP','2017-04',62,78);
INSERT INTO BAR_CHART VALUES('CIDFNP','2017-05',85,82);
INSERT INTO BAR_CHART VALUES('CIDFNP','2017-06',51,55);
INSERT INTO BAR_CHART VALUES('CIDFNP','2017-07',68,70);
INSERT INTO BAR_CHART VALUES('CIDFNP','2017-08',79,82);
INSERT INTO BAR_CHART VALUES('CIDFNP','2017-09',81,85);

CREATE TABLE SENTIMENT_CHART(CP_ID VARCHAR(50),positive INTEGER,negative INTEGER,neutral INTEGER)

INSERT INTO BAR_CHART VALUES('CIDFNP',25,25,50);


COUNTERPARTY_MASTER
-------------------
CM_CP_NAME		
CM_CP_ID		
CM_CNCTD_CP_ID		
CM_NTR_RLTN		
CM_ULT_PARNT_NAME		
CM_ULT_PARENT_ID		
CM_TRACKING_STATUS		
CM_CURRENT_RATING		
CM_PAST_RATING		
CM_RATING_AGENCY		
CM_DOMICILE_CNTRY

CLIENT_MASTER
-------------
CLM_CLIENT_NAME		
CLM_CLIENT_ID	
CLM_RISK_OFFICER		
CLM_EMAIL_ID		
CLM_CONTACT_NO
CLM_DELIVERY_STATUS		
CLM_DLVR_ATMP_TIME

DETAILS_FROM_CLIENT
------------------
CDC_CLIENT_ID	
CDC_LEGAL_ENTITYTYPE	
CDC_MTM_NET	
CDC_CVA	
CDC_AGRMNT_DATE	
CDC_CSA	
CDC_CLOSE_NETNG_LGL_OPIN	
CDC_CLOSEOUT_NETTING	
CDC_CLOSE_NETNG_LGL_OPIN_TYP	
CDC_STLMNT_NTNG	
CDC_CLOSE_NETNG_LGL_OPIN_DATE	
CDC_USE_NTNG_POOL	
CDC_PRODUCTS	
CDC_DEAL_COUNT	
CDC_EXP_TYPE	
CDC_MEASURE	
CDC_TIME_BAND	
CDC_LIMIT	
CDC_EXPOSURE	
CDC_AVAILABLE	
CDC_LIMIT_EXP	
CDC_TENOR	
CDC_INT_RATING	
CDC_CNTRY_RISK	
CDC_CNTRY_DMCILE
	   
ANALYTICAL_DETAILS
---------------------
AD_SEQUENCE_NO
AD_COUNTERPARTY_ID	
AD_SCORE	
AD_SCORE_UPDTIME	
AD_NUMBER_ARTICLES	
AD_LAST_CPTRTIME


LAST_SEQ_NUMBER
---------------
LSN_FOR_NR
LSN_FOR_AD

NEWS_ARCHIVAL
--------------
NA_SEQUENCE_NO	
NA_COUNTERPARTY_ID	
NA_SCORE	
NA_ARCHVL_DATETIME	
NA_NUMBER_ARTICLES	
NA_SCORE_UPDTTIME	
NA_LAST_CPTRTIME

NEWS_REPOSITORY
---------------
NR_SEQUENCE_NO	
NR_COUNTERPARTY_ID	
NR_NEWS_URL	
NR_NEWS_SOURCE	
NR_NEWS_HEADER	
NR_PBLSH_DTTIME	
NR_CAPTURE_DTTIME	
NR_SCORE	
NR_NEWS_TEXTS

NEWS_SOURCE_MASTER
-------------------
NS_CP_ID	
NS_DOMAIN_NAME	
NS_DOMAIN_URL	
NS_GEOGRAPHY	
NS_SCORE	
NS_TRACKING_STATUS	
NS_DESCRIPTION	
NS_NUMBER_ARTICLES

TRACKING_TABLE
---------------
TT_CLIENT_ID		
TT_COUNTERPARTY_ID		
TT_TRACKING_STATUS	